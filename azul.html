<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¨ ì•„ì¤„ (Azul) - í¬ë¥´íˆ¬ê°ˆ íƒ€ì¼ ê²Œì„</title>
    <style>
        /* ===== ì „ì—­ ìŠ¤íƒ€ì¼ ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #2C3E50 0%, #34495E 100%);
            color: #ECF0F1;
            min-height: 100vh;
            padding: 15px;
        }

        /* ===== ê²Œì„ ì»¨í…Œì´ë„ˆ ===== */
        .game-container {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* ===== í—¤ë” ===== */
        .game-header {
            text-align: center;
            margin-bottom: 15px;
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
        }

        .game-header h1 {
            font-size: 2em;
            margin-bottom: 8px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .game-status {
            font-size: 1.1em;
            margin: 8px 0;
        }

        .round-info {
            display: inline-block;
            background: rgba(255, 255, 255, 0.1);
            padding: 5px 15px;
            border-radius: 20px;
            margin: 0 10px;
        }

        /* ===== ë²„íŠ¼ ìŠ¤íƒ€ì¼ ===== */
        .button-group {
            margin-top: 10px;
        }

        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.95em;
            margin: 0 5px;
            transition: all 0.3s;
        }

        button:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        button:disabled {
            background: #7f8c8d;
            cursor: not-allowed;
            transform: none;
        }

        /* í™ˆ ë²„íŠ¼ íŠ¹ë³„ ìŠ¤íƒ€ì¼ */
        .button-group button:first-child {
            background: #2ecc71;
        }

        .button-group button:first-child:hover {
            background: #27ae60;
        }

        /* ===== ë³´ë“œ ì»¨í…Œì´ë„ˆ (ìˆ˜í‰ ë°°ì¹˜) ===== */
        .boards-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .player-board-container {
            background: rgba(0, 0, 0, 0.3);
            padding: 12px;
            border-radius: 10px;
            min-height: 350px;
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
        }

        /* í„´ì´ ì•„ë‹ ë•Œ ì–´ë‘¡ê²Œ */
        .player-board-container.inactive {
            opacity: 0.5;
            background: rgba(0, 0, 0, 0.5);
        }

        /* í˜„ì¬ í„´ì¼ ë•Œ ë°ê²Œ í•˜ì´ë¼ì´íŠ¸ */
        .player-board-container.active {
            opacity: 1;
            background: rgba(52, 152, 219, 0.15);
            border: 3px solid #3498db;
            box-shadow: 0 0 30px rgba(52, 152, 219, 0.4);
        }

        .player-board-container.active::before {
            content: 'í˜„ì¬ í„´';
            position: absolute;
            top: 10px;
            right: 110px;
            background: #3498db;
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: bold;
            z-index: 10;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.05); }
        }

        .player-board-header {
            margin-bottom: 10px;
            font-size: 1.2em;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .player-name {
            font-weight: bold;
            font-size: 1.3em;
        }

        /* í”Œë ˆì´ì–´ AëŠ” íŒŒë€ìƒ‰ ê³„ì—´ */
        #player-a-container .player-name {
            color: #5dade2;
        }

        #player-a-container.active {
            background: rgba(93, 173, 226, 0.15);
            border-color: #5dade2;
            box-shadow: 0 0 30px rgba(93, 173, 226, 0.4);
        }

        #player-a-container.active::before {
            background: #5dade2;
            right: 110px;
        }

        /* í”Œë ˆì´ì–´ BëŠ” ì£¼í™©ìƒ‰ ê³„ì—´ */
        #player-b-container .player-name {
            color: #f39c12;
        }

        #player-b-container.active {
            background: rgba(243, 156, 18, 0.15);
            border-color: #f39c12;
            box-shadow: 0 0 30px rgba(243, 156, 18, 0.4);
        }

        #player-b-container.active::before {
            background: #f39c12;
            right: 110px;
        }

        .player-board-container .player-board {
            transform: scale(0.85);
            transform-origin: top left;
        }

        /* ===== ê³µì¥ ì˜ì—­ ===== */
        .factories-area {
            background: rgba(0, 0, 0, 0.3);
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .factories-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 15px;
            align-items: start;
        }

        .factories-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
        }

        .factory {
            width: 100px;
            height: 100px;
            background: rgba(255, 255, 255, 0.1);
            border: 3px solid #7f8c8d;
            border-radius: 50%;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            padding: 8px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .factory:hover {
            border-color: #3498db;
            transform: scale(1.05);
        }

        .factory.selectable {
            border-color: #2ecc71;
            box-shadow: 0 0 15px rgba(46, 204, 113, 0.5);
        }

        .center-area {
            min-height: 200px;
            background: rgba(255, 255, 255, 0.05);
            border: 3px dashed #95a5a6;
            border-radius: 15px;
            padding: 10px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .center-area:hover {
            border-color: #3498db;
        }

        .center-area.selectable {
            border-color: #2ecc71;
            box-shadow: 0 0 15px rgba(46, 204, 113, 0.5);
        }

        .center-area h4 {
            width: 100%;
            text-align: center;
            color: #95a5a6;
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        /* ===== íƒ€ì¼ ìŠ¤íƒ€ì¼ ===== */
        .tile {
            width: 30px;
            height: 30px;
            border-radius: 5px;
            border: 2px solid rgba(0, 0, 0, 0.3);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            transition: all 0.2s;
        }

        .tile:hover {
            transform: scale(1.1);
        }

        .tile.blue { background: #4A90E2; }
        .tile.yellow { background: #F5D547; }
        .tile.red { background: #E74C3C; }
        .tile.black { background: #2C3E50; }
        .tile.white { background: #ECF0F1; }
        .tile.start-marker {
            background: #e67e22;
            border-radius: 50%;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        /* ===== í”Œë ˆì´ì–´ ë³´ë“œ ===== */
        .player-board {
            display: flex;
            gap: 15px;
            align-items: flex-start;
        }

        .score {
            color: #2ecc71;
            font-weight: bold;
            font-size: 1.4em;
        }

        /* ===== íŒ¨í„´ ë¼ì¸ ===== */
        .pattern-lines {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .pattern-line {
            display: flex;
            align-items: center;
            gap: 4px;
            cursor: pointer;
            padding: 4px;
            border-radius: 5px;
            transition: all 0.3s;
        }

        .pattern-line:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .pattern-line.selectable {
            background: rgba(46, 204, 113, 0.2);
            border: 2px solid #2ecc71;
        }

        .pattern-slot {
            width: 30px;
            height: 30px;
            border: 2px dashed #7f8c8d;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .pattern-slot.filled {
            border-style: solid;
        }

        /* ===== ë²½ ===== */
        .wall {
            display: grid;
            grid-template-columns: repeat(5, 34px);
            gap: 4px;
        }

        .wall-slot {
            width: 34px;
            height: 34px;
            border: 2px solid #7f8c8d;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .wall-slot::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0.2;
            border-radius: 5px;
        }

        .wall-slot.blue::before { background: #4A90E2; }
        .wall-slot.yellow::before { background: #F5D547; }
        .wall-slot.red::before { background: #E74C3C; }
        .wall-slot.black::before { background: #2C3E50; }
        .wall-slot.white::before { background: #ECF0F1; }

        .wall-slot.filled {
            border-width: 3px;
        }

        .wall-slot.filled.blue { background: #4A90E2; border-color: #2C5AA0; }
        .wall-slot.filled.yellow { background: #F5D547; border-color: #C4A836; }
        .wall-slot.filled.red { background: #E74C3C; border-color: #C0392B; }
        .wall-slot.filled.black { background: #2C3E50; border-color: #1A252F; }
        .wall-slot.filled.white { background: #ECF0F1; border-color: #BDC3C7; }

        /* ===== ë°”ë‹¥ ë¼ì¸ ===== */
        .floor-line {
            margin-top: 10px;
            padding: 8px;
            background: rgba(231, 76, 60, 0.2);
            border-radius: 5px;
        }

        .floor-line h4 {
            margin-bottom: 6px;
            color: #e74c3c;
            font-size: 0.9em;
        }

        .floor-slots {
            display: flex;
            gap: 4px;
        }

        .floor-slot {
            width: 30px;
            height: 30px;
            border: 2px dashed #e74c3c;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .floor-penalty {
            position: absolute;
            bottom: -16px;
            font-size: 0.75em;
            color: #e74c3c;
            font-weight: bold;
        }

        /* ===== ì„¹ì…˜ ì œëª© ===== */
        .section-title {
            margin-bottom: 8px;
            font-size: 0.95em;
            font-weight: bold;
            color: #3498db;
        }

        /* ===== ëª¨ë‹¬ (ê·œì¹™ ì„¤ëª…) ===== */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            overflow: auto;
        }

        .modal-content {
            background: #34495E;
            margin: 50px auto;
            padding: 30px;
            border-radius: 10px;
            max-width: 800px;
            color: #ECF0F1;
        }

        .modal-content h2 {
            color: #3498db;
            margin-bottom: 20px;
        }

        .modal-content h3 {
            color: #2ecc71;
            margin-top: 20px;
            margin-bottom: 10px;
        }

        .modal-content ul {
            margin-left: 20px;
            line-height: 1.8;
        }

        .close-modal {
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: #e74c3c;
        }

        .close-modal:hover {
            color: #c0392b;
        }

        /* ===== ê²Œì„ ì¢…ë£Œ íŒì—… ===== */
        .game-over-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 998;
            animation: fadeIn 0.3s ease;
        }

        .game-over {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #2C3E50 0%, #34495E 100%);
            padding: 50px;
            border-radius: 20px;
            text-align: center;
            z-index: 999;
            min-width: 450px;
            border: 4px solid #f39c12;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.8);
            animation: popIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes popIn {
            0% {
                transform: translate(-50%, -50%) scale(0.5);
                opacity: 0;
            }
            100% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
        }

        .game-over h2 {
            font-size: 3em;
            margin-bottom: 20px;
            color: #f39c12;
            text-shadow: 0 0 20px rgba(243, 156, 18, 0.5);
            animation: glow 2s ease-in-out infinite;
        }

        @keyframes glow {
            0%, 100% { text-shadow: 0 0 20px rgba(243, 156, 18, 0.5); }
            50% { text-shadow: 0 0 30px rgba(243, 156, 18, 0.8), 0 0 40px rgba(243, 156, 18, 0.6); }
        }

        .game-over .winner-announcement {
            font-size: 2em;
            margin: 30px 0;
            padding: 20px;
            background: rgba(46, 204, 113, 0.2);
            border-radius: 10px;
            border: 2px solid #2ecc71;
        }

        .game-over .winner-announcement.draw {
            background: rgba(52, 152, 219, 0.2);
            border-color: #3498db;
        }

        .game-over .final-scores {
            margin: 30px 0;
            font-size: 1.4em;
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 10px;
        }

        .game-over .final-scores p {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            transition: all 0.3s;
        }

        .game-over .final-scores p:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
        }

        .game-over button {
            font-size: 1.2em;
            padding: 15px 40px;
            margin-top: 20px;
            background: #2ecc71;
            width: auto;
        }

        .game-over button:hover {
            background: #27ae60;
            transform: translateY(-3px);
        }

        @media (max-width: 768px) {
            .game-over {
                min-width: 90%;
                padding: 30px 20px;
            }

            .game-over h2 {
                font-size: 2em;
            }

            .game-over .winner-announcement {
                font-size: 1.5em;
            }

            .game-over .final-scores {
                font-size: 1.2em;
            }
        }

        /* ===== ì• ë‹ˆë©”ì´ì…˜ ===== */
        @keyframes tileMove {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .tile-moving {
            animation: tileMove 0.3s ease;
        }

        /* ===== ë°˜ì‘í˜• ===== */
        @media (max-width: 1200px) {
            .boards-container {
                grid-template-columns: 1fr;
            }

            .player-board-container .player-board {
                transform: scale(0.7);
            }

            .factories-content {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .game-header h1 {
                font-size: 1.8em;
            }

            .factory {
                width: 80px;
                height: 80px;
            }

            .tile {
                width: 25px;
                height: 25px;
            }

            .pattern-slot, .floor-slot {
                width: 25px;
                height: 25px;
            }

            .wall {
                grid-template-columns: repeat(5, 28px);
            }

            .wall-slot {
                width: 28px;
                height: 28px;
            }

            .player-board-container .player-board {
                transform: scale(0.6);
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- ê²Œì„ í—¤ë” -->
        <div class="game-header">
            <h1>ğŸ¨ ì•„ì¤„ (Azul)</h1>
            <div class="game-status">
                <span class="round-info">ë¼ìš´ë“œ: <span id="round-number">1</span></span>
                <span class="round-info" id="current-turn-display">í˜„ì¬ í„´: í”Œë ˆì´ì–´ 1</span>
            </div>
            <div class="button-group">
                <button onclick="window.location.href='index.html'">ğŸ  í™ˆìœ¼ë¡œ</button>
                <button onclick="showRules()">ğŸ“– ê²Œì„ ê·œì¹™</button>
                <button onclick="restartGame()">ğŸ”„ ìƒˆ ê²Œì„</button>
                <button onclick="toggleAI()" id="ai-toggle">ğŸ‘¤ í”Œë ˆì´ì–´ B: ì‚¬ëŒ</button>
            </div>
        </div>

        <!-- í”Œë ˆì´ì–´ ë³´ë“œë“¤ (ìˆ˜í‰ ë°°ì¹˜) -->
        <div class="boards-container">
            <!-- í”Œë ˆì´ì–´ A ë³´ë“œ -->
            <div class="player-board-container" id="player-a-container">
                <div class="player-board-header">
                    <span class="player-name">ğŸ”µ í”Œë ˆì´ì–´ A</span>
                    <span class="score" id="player-a-score">0ì </span>
                </div>
                <div id="player-a-board"></div>
            </div>

            <!-- í”Œë ˆì´ì–´ B ë³´ë“œ -->
            <div class="player-board-container" id="player-b-container">
                <div class="player-board-header">
                    <span class="player-name">ğŸŸ  í”Œë ˆì´ì–´ B</span>
                    <span class="score" id="player-b-score">0ì </span>
                </div>
                <div id="player-b-board"></div>
            </div>
        </div>

        <!-- ê³µì¥ ì˜ì—­ -->
        <div class="factories-area">
            <div class="factories-content">
                <div>
                    <h3 class="section-title">ğŸ­ ê³µì¥ ë””ìŠ¤í”Œë ˆì´</h3>
                    <div class="factories-container" id="factories"></div>
                </div>
                <div>
                    <h3 class="section-title">ğŸ¯ ì¤‘ì•™ ì˜ì—­</h3>
                    <div class="center-area" id="center"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- ê·œì¹™ ëª¨ë‹¬ -->
    <div id="rules-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeRules()">&times;</span>
            <h2>ğŸ¨ ì•„ì¤„ ê²Œì„ ê·œì¹™</h2>
            
            <h3>ê²Œì„ ëª©í‘œ</h3>
            <p>í¬ë¥´íˆ¬ê°ˆ íƒ€ì¼ ì¥ì¸ì´ ë˜ì–´ ê¶ì „ ë²½ì„ ì•„ë¦„ë‹µê²Œ ì¥ì‹í•˜ê³  ê°€ì¥ ë§ì€ ì ìˆ˜ë¥¼ íšë“í•˜ì„¸ìš”!</p>
            
            <h3>ê²Œì„ ì§„í–‰</h3>
            <ul>
                <li><strong>1ë‹¨ê³„:</strong> ê³µì¥ì— íƒ€ì¼ 4ê°œì”© ë°°ì¹˜</li>
                <li><strong>2ë‹¨ê³„:</strong> í„´ì„ ëŒì•„ê°€ë©° íƒ€ì¼ ì„ íƒ
                    <ul>
                        <li>ê³µì¥ ë˜ëŠ” ì¤‘ì•™ì—ì„œ ê°™ì€ ìƒ‰ íƒ€ì¼ ì „ë¶€ ê°€ì ¸ê°€ê¸°</li>
                        <li>ê³µì¥ì—ì„œ ì„ íƒ ì‹œ, ë‚˜ë¨¸ì§€ëŠ” ì¤‘ì•™ìœ¼ë¡œ ì´ë™</li>
                        <li>ì¤‘ì•™ì—ì„œ ì²˜ìŒ ê°€ì ¸ê°€ëŠ” ì‚¬ëŒì€ ì‹œì‘ ë§ˆì»¤(-1ì ) íšë“</li>
                        <li>íŒ¨í„´ ë¼ì¸ ì¤‘ í•œ ì¤„ì— ë°°ì¹˜ (ê°™ì€ ìƒ‰ë§Œ ê°€ëŠ¥)</li>
                    </ul>
                </li>
                <li><strong>3ë‹¨ê³„:</strong> ë¼ìš´ë“œ ì¢…ë£Œ
                    <ul>
                        <li>ì™„ì„±ëœ íŒ¨í„´ ë¼ì¸ì˜ íƒ€ì¼ 1ê°œë¥¼ ë²½ìœ¼ë¡œ ì´ë™</li>
                        <li>ì ìˆ˜ ê³„ì‚° (ê¸°ë³¸ 1ì  + ì¸ì ‘ íƒ€ì¼ ë³´ë„ˆìŠ¤)</li>
                        <li>ë°”ë‹¥ ë¼ì¸ ë²Œì  ì²˜ë¦¬</li>
                    </ul>
                </li>
            </ul>
            
            <h3>ì ìˆ˜ ê³„ì‚°</h3>
            <ul>
                <li>íƒ€ì¼ ë°°ì¹˜: 1ì  (ê¸°ë³¸)</li>
                <li>ê°€ë¡œ ì¸ì ‘ íƒ€ì¼: ê° +1ì </li>
                <li>ì„¸ë¡œ ì¸ì ‘ íƒ€ì¼: ê° +1ì </li>
                <li>ë°”ë‹¥ ë¼ì¸ ë²Œì : -1, -1, -2, -2, -2, -3, -3</li>
            </ul>
            
            <h3>ê²Œì„ ì¢…ë£Œ</h3>
            <p>ëˆ„êµ°ê°€ ë²½ì˜ ê°€ë¡œì¤„ 1ê°œë¥¼ ì™„ì„±í•˜ë©´ ê²Œì„ ì¢…ë£Œ</p>
            <ul>
                <li>ê°€ë¡œì¤„ ì™„ì„±: ì¤„ë‹¹ +2ì </li>
                <li>ì„¸ë¡œì¤„ ì™„ì„±: ì¤„ë‹¹ +7ì </li>
                <li>ê°™ì€ ìƒ‰ 5ê°œ: ìƒ‰ë‹¹ +10ì </li>
            </ul>
            
            <button onclick="closeRules()" style="margin-top: 20px; width: 100%;">ë‹«ê¸°</button>
        </div>
    </div>

    <script>
        // ===== ê²Œì„ ìƒìˆ˜ =====
        const COLORS = ['blue', 'yellow', 'red', 'black', 'white'];
        const TILES_PER_COLOR = 20;
        const TILES_PER_FACTORY = 4;
        const WALL_PATTERN = [
            ['blue', 'yellow', 'red', 'black', 'white'],
            ['white', 'blue', 'yellow', 'red', 'black'],
            ['black', 'white', 'blue', 'yellow', 'red'],
            ['red', 'black', 'white', 'blue', 'yellow'],
            ['yellow', 'red', 'black', 'white', 'blue']
        ];
        const FLOOR_PENALTIES = [-1, -1, -2, -2, -2, -3, -3];

        // ===== ê²Œì„ ìƒíƒœ =====
        let game = {
            players: [],
            factories: [],
            center: [],
            currentPlayer: 0,
            round: 1,
            bag: [],
            discard: [],
            gameOver: false,
            aiEnabled: false,
            selectedTiles: null,
            selectedSource: null
        };

        // ===== í”Œë ˆì´ì–´ í´ë˜ìŠ¤ =====
        class Player {
            constructor(name, isAI = false) {
                this.name = name;
                this.isAI = isAI;
                this.score = 0;
                this.patternLines = [[], [], [], [], []]; // 1~5ì¹¸
                this.wall = Array(5).fill(null).map(() => Array(5).fill(false));
                this.floor = [];
                this.hasStartMarker = false;
            }

            // íŒ¨í„´ ë¼ì¸ì´ ê°€ë“ ì°¼ëŠ”ì§€ í™•ì¸
            isPatternLineFull(lineIndex) {
                return this.patternLines[lineIndex].length === lineIndex + 1;
            }

            // íŒ¨í„´ ë¼ì¸ì— ìƒ‰ì„ ë°°ì¹˜í•  ìˆ˜ ìˆëŠ”ì§€ í™•ì¸
            canPlaceInPatternLine(lineIndex, color) {
                const line = this.patternLines[lineIndex];
                // ë¹ˆ ì¤„ì´ê±°ë‚˜ ê°™ì€ ìƒ‰ì´ ìˆì–´ì•¼ í•¨
                if (line.length === 0) {
                    // ë²½ì— ì´ë¯¸ í•´ë‹¹ ìƒ‰ì´ ìˆëŠ”ì§€ í™•ì¸
                    const wallColorIndex = WALL_PATTERN[lineIndex].indexOf(color);
                    return !this.wall[lineIndex][wallColorIndex];
                }
                return line[0] === color;
            }

            // íŒ¨í„´ ë¼ì¸ì— íƒ€ì¼ ì¶”ê°€
            addToPatternLine(lineIndex, tiles) {
                const maxCapacity = lineIndex + 1;
                const currentCount = this.patternLines[lineIndex].length;
                const canAdd = Math.min(tiles.length, maxCapacity - currentCount);
                
                for (let i = 0; i < canAdd; i++) {
                    this.patternLines[lineIndex].push(tiles[i]);
                }

                // ë„˜ì¹˜ëŠ” íƒ€ì¼ì€ ë°”ë‹¥ìœ¼ë¡œ
                for (let i = canAdd; i < tiles.length; i++) {
                    this.addToFloor(tiles[i]);
                }
            }

            // ë°”ë‹¥ ë¼ì¸ì— íƒ€ì¼ ì¶”ê°€
            addToFloor(tile) {
                if (this.floor.length < 7) {
                    this.floor.push(tile);
                }
            }

            // ë²½ì— íƒ€ì¼ ë°°ì¹˜ ë° ì ìˆ˜ ê³„ì‚°
            scoreWallTile(row, col) {
                this.wall[row][col] = true;
                let score = 1;
                let horizontalCount = 1;
                let verticalCount = 1;

                // ê°€ë¡œ ë°©í–¥ ì²´í¬
                let left = col - 1;
                while (left >= 0 && this.wall[row][left]) {
                    horizontalCount++;
                    left--;
                }
                let right = col + 1;
                while (right < 5 && this.wall[row][right]) {
                    horizontalCount++;
                    right++;
                }

                // ì„¸ë¡œ ë°©í–¥ ì²´í¬
                let up = row - 1;
                while (up >= 0 && this.wall[up][col]) {
                    verticalCount++;
                    up--;
                }
                let down = row + 1;
                while (down < 5 && this.wall[down][col]) {
                    verticalCount++;
                    down++;
                }

                // ì ìˆ˜ ê³„ì‚°
                if (horizontalCount > 1) score += horizontalCount - 1;
                if (verticalCount > 1) score += verticalCount - 1;

                return score;
            }

            // ë¼ìš´ë“œ ì¢…ë£Œ ì‹œ ì ìˆ˜ ê³„ì‚°
            endRoundScoring() {
                let roundScore = 0;

                // ì™„ì„±ëœ íŒ¨í„´ ë¼ì¸ ì²˜ë¦¬
                for (let i = 0; i < 5; i++) {
                    if (this.isPatternLineFull(i)) {
                        const color = this.patternLines[i][0];
                        const colIndex = WALL_PATTERN[i].indexOf(color);
                        
                        // ë²½ì— ë°°ì¹˜í•˜ê³  ì ìˆ˜ ê³„ì‚°
                        roundScore += this.scoreWallTile(i, colIndex);

                        // íŒ¨í„´ ë¼ì¸ì˜ ë‚˜ë¨¸ì§€ íƒ€ì¼ë“¤ì„ ë²„ë¦¼ ë”ë¯¸ë¡œ
                        // (ë²½ì— ë°°ì¹˜í•œ 1ê°œëŠ” ê²Œì„ì—ì„œ ì˜êµ¬ ì œê±°, ë‚˜ë¨¸ì§€ë§Œ ë²„ë¦¼ ë”ë¯¸ë¡œ)
                        for (let j = 1; j < this.patternLines[i].length; j++) {
                            game.discard.push(this.patternLines[i][j]);
                        }
                        this.patternLines[i] = [];
                    }
                }

                // ë°”ë‹¥ ë¼ì¸ ë²Œì 
                for (let i = 0; i < this.floor.length; i++) {
                    if (i < FLOOR_PENALTIES.length) {
                        roundScore += FLOOR_PENALTIES[i];
                    }
                }

                // ì‹œì‘ ë§ˆì»¤ ì²˜ë¦¬
                if (this.hasStartMarker) {
                    game.currentPlayer = game.players.indexOf(this);
                    this.hasStartMarker = false;
                }

                // ë°”ë‹¥ ë¼ì¸ì˜ íƒ€ì¼ë“¤ì„ ë²„ë¦¼ ë”ë¯¸ë¡œ (ì‹œì‘ ë§ˆì»¤ ì œì™¸)
                for (let i = 0; i < this.floor.length; i++) {
                    if (this.floor[i] !== 'start') {
                        game.discard.push(this.floor[i]);
                    }
                }
                this.floor = [];

                // ì ìˆ˜ëŠ” 0 ì´í•˜ë¡œ ë‚´ë ¤ê°€ì§€ ì•ŠìŒ
                this.score = Math.max(0, this.score + roundScore);

                return roundScore;
            }

            // ê²Œì„ ì¢…ë£Œ ì‹œ ë³´ë„ˆìŠ¤ ì ìˆ˜
            finalScoring() {
                let bonus = 0;

                // ê°€ë¡œì¤„ ì™„ì„± ì²´í¬
                for (let row = 0; row < 5; row++) {
                    if (this.wall[row].every(cell => cell)) {
                        bonus += 2;
                    }
                }

                // ì„¸ë¡œì¤„ ì™„ì„± ì²´í¬
                for (let col = 0; col < 5; col++) {
                    let complete = true;
                    for (let row = 0; row < 5; row++) {
                        if (!this.wall[row][col]) {
                            complete = false;
                            break;
                        }
                    }
                    if (complete) bonus += 7;
                }

                // ê°™ì€ ìƒ‰ 5ê°œ ì™„ì„± ì²´í¬
                for (let colorIndex = 0; colorIndex < 5; colorIndex++) {
                    let complete = true;
                    for (let row = 0; row < 5; row++) {
                        const col = WALL_PATTERN[row].indexOf(COLORS[colorIndex]);
                        if (!this.wall[row][col]) {
                            complete = false;
                            break;
                        }
                    }
                    if (complete) bonus += 10;
                }

                this.score += bonus;
                return bonus;
            }

            // ê²Œì„ ì¢…ë£Œ ì¡°ê±´ ì²´í¬
            hasCompletedRow() {
                return this.wall.some(row => row.every(cell => cell));
            }
        }

        // ===== ê²Œì„ ì´ˆê¸°í™” =====
        function initGame() {
            game.players = [
                new Player('í”Œë ˆì´ì–´ A', false),
                new Player('í”Œë ˆì´ì–´ B', game.aiEnabled)
            ];
            game.currentPlayer = 0;
            game.round = 1;
            game.gameOver = false;
            game.selectedTiles = null;
            game.selectedSource = null;

            // íƒ€ì¼ ê°€ë°© ì´ˆê¸°í™”
            game.bag = [];
            for (let color of COLORS) {
                for (let i = 0; i < TILES_PER_COLOR; i++) {
                    game.bag.push(color);
                }
            }
            shuffleArray(game.bag);

            game.discard = [];
            game.factories = [];
            game.center = [];

            startNewRound();
            renderGame();

            // ì²« í”Œë ˆì´ì–´ê°€ AIë©´ AI í„´ ì‹œì‘
            if (game.players[game.currentPlayer].isAI) {
                setTimeout(aiTurn, 1000);
            }
        }

        // ===== ìƒˆ ë¼ìš´ë“œ ì‹œì‘ =====
        function startNewRound() {
            console.log('========================================');
            console.log('ìƒˆ ë¼ìš´ë“œ ì‹œì‘:', game.round);
            console.log('ê°€ë°©ì— ë‚¨ì€ íƒ€ì¼:', game.bag.length);
            console.log('ë²„ë¦° íƒ€ì¼:', game.discard.length);

            // ê³µì¥ ê°œìˆ˜ ì„¤ì • (2ì¸: 5ê°œ)
            const factoryCount = 5;
            game.factories = [];

            // ê° ê³µì¥ì— íƒ€ì¼ 4ê°œì”© ë°°ì¹˜
            for (let i = 0; i < factoryCount; i++) {
                const factoryTiles = [];
                for (let j = 0; j < TILES_PER_FACTORY; j++) {
                    // ê°€ë°©ì´ ë¹„ë©´ ë²„ë¦° íƒ€ì¼ ë‹¤ì‹œ ì„ì–´ì„œ ì¶”ê°€
                    if (game.bag.length === 0) {
                        if (game.discard.length > 0) {
                            console.log('ê°€ë°©ì´ ë¹„ì—ˆìŠµë‹ˆë‹¤. ë²„ë¦° íƒ€ì¼ì„ ë‹¤ì‹œ ì„ìŠµë‹ˆë‹¤:', game.discard.length + 'ê°œ');
                            game.bag = [...game.discard];
                            game.discard = [];
                            shuffleArray(game.bag);
                        } else {
                            console.warn('ê°€ë°©ê³¼ ë²„ë¦¼ íƒ€ì¼ì´ ëª¨ë‘ ë¹„ì—ˆìŠµë‹ˆë‹¤!');
                            break;
                        }
                    }
                    if (game.bag.length > 0) {
                        factoryTiles.push(game.bag.pop());
                    }
                }
                
                // íƒ€ì¼ì´ ìˆëŠ” ê³µì¥ë§Œ ì¶”ê°€
                if (factoryTiles.length > 0) {
                    game.factories.push(factoryTiles);
                    console.log(`ê³µì¥ ${i}: ${factoryTiles.length}ê°œ íƒ€ì¼ ë°°ì¹˜`);
                }
            }

            // ì¤‘ì•™ì€ ë¹„ìš°ê³  ì‹œì‘ ë§ˆì»¤ë§Œ ì¶”ê°€
            game.center = ['start'];
            
            console.log('ë¼ìš´ë“œ ì¤€ë¹„ ì™„ë£Œ. ê³µì¥ ìˆ˜:', game.factories.length);
            console.log('========================================');
        }

        // ===== íƒ€ì¼ ì„ íƒ ì²˜ë¦¬ =====
        function selectTilesFromFactory(factoryIndex, color) {
            if (game.gameOver) return;

            const factory = game.factories[factoryIndex];
            const selectedTiles = factory.filter(t => t === color);
            const remainingTiles = factory.filter(t => t !== color);

            if (selectedTiles.length === 0) return;

            console.log(game.players[game.currentPlayer].name + 'ê°€ ê³µì¥ì—ì„œ ì„ íƒ:', color, selectedTiles.length + 'ê°œ');

            // ì„ íƒí•œ íƒ€ì¼ ì €ì¥
            game.selectedTiles = selectedTiles;
            game.selectedSource = { type: 'factory', index: factoryIndex };

            // ë‚˜ë¨¸ì§€ íƒ€ì¼ì€ ì¤‘ì•™ìœ¼ë¡œ
            game.center.push(...remainingTiles);
            game.factories[factoryIndex] = [];

            // íŒ¨í„´ ë¼ì¸ ì„ íƒ ëŒ€ê¸°
            renderGame();
        }

        function selectTilesFromCenter(color) {
            if (game.gameOver) return;

            const selectedTiles = game.center.filter(t => t === color);
            if (selectedTiles.length === 0) return;

            console.log(game.players[game.currentPlayer].name + 'ê°€ ì¤‘ì•™ì—ì„œ ì„ íƒ:', color, selectedTiles.length + 'ê°œ');

            game.selectedTiles = selectedTiles;
            game.selectedSource = { type: 'center' };

            // ì‹œì‘ ë§ˆì»¤ í™•ì¸
            const hasStartMarker = game.center.includes('start');
            game.center = game.center.filter(t => t !== color && t !== 'start');

            if (hasStartMarker) {
                console.log(game.players[game.currentPlayer].name + 'ê°€ ì‹œì‘ ë§ˆì»¤ íšë“');
                game.players[game.currentPlayer].hasStartMarker = true;
                game.players[game.currentPlayer].floor.push('start');
            }

            renderGame();
        }

        // ===== íŒ¨í„´ ë¼ì¸ì— ë°°ì¹˜ =====
        function placeInPatternLine(lineIndex) {
            if (!game.selectedTiles) {
                console.error('placeInPatternLine: selectedTilesê°€ nullì…ë‹ˆë‹¤!');
                return;
            }

            const player = game.players[game.currentPlayer];
            const color = game.selectedTiles[0];

            console.log(`${player.name}ê°€ íŒ¨í„´ ë¼ì¸ ${lineIndex + 1}ì— ${color} íƒ€ì¼ ${game.selectedTiles.length}ê°œ ë°°ì¹˜ ì‹œë„`);

            // ì‚¬ëŒ í”Œë ˆì´ì–´ì˜ ê²½ìš° ë°°ì¹˜ ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸
            if (!player.isAI && !player.canPlaceInPatternLine(lineIndex, color)) {
                alert('ì´ ì¤„ì—ëŠ” í•´ë‹¹ ìƒ‰ì„ ë°°ì¹˜í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤!');
                return;
            }

            player.addToPatternLine(lineIndex, game.selectedTiles);
            game.selectedTiles = null;
            game.selectedSource = null;

            console.log(`${player.name} ë°°ì¹˜ ì™„ë£Œ. íŒ¨í„´ ë¼ì¸ ìƒíƒœ:`, player.patternLines[lineIndex]);

            // í„´ ì¢…ë£Œ ì²´í¬
            const roundOver = isRoundOver();
            
            if (roundOver) {
                console.log('ë¼ìš´ë“œ ì¢…ë£Œ - endRound í˜¸ì¶œ');
                endRound();
                // endRound ë‚´ë¶€ì—ì„œ renderGameê³¼ AI í„´ ì²´í¬ë¥¼ í•¨
            } else {
                nextTurn();
                renderGame();

                // ë‹¤ìŒ í”Œë ˆì´ì–´ê°€ AIë©´ AI í„´ ì‹¤í–‰
                if (!game.gameOver && game.players[game.currentPlayer].isAI) {
                    console.log('ë‹¤ìŒ í”Œë ˆì´ì–´ëŠ” AI - aiTurn í˜¸ì¶œ');
                    setTimeout(aiTurn, 800);
                }
            }
        }

        // ===== ë¼ìš´ë“œ ì¢…ë£Œ í™•ì¸ =====
        function isRoundOver() {
            const allFactoriesEmpty = game.factories.every(f => f.length === 0);
            const centerEmpty = game.center.length === 0;
            const isOver = allFactoriesEmpty && centerEmpty;
            
            if (isOver) {
                console.log('ë¼ìš´ë“œ ì¢…ë£Œ ì¡°ê±´ ì¶©ì¡±: ëª¨ë“  ê³µì¥ê³¼ ì¤‘ì•™ì´ ë¹„ì—ˆìŠµë‹ˆë‹¤');
            }
            
            return isOver;
        }

        // ===== ë¼ìš´ë“œ ì¢…ë£Œ ì²˜ë¦¬ =====
        function endRound() {
            console.log('========================================');
            console.log('ë¼ìš´ë“œ ì¢…ë£Œ:', game.round);
            
            // ê° í”Œë ˆì´ì–´ ì ìˆ˜ ê³„ì‚°
            for (let player of game.players) {
                const roundScore = player.endRoundScoring();
                console.log(`${player.name} ë¼ìš´ë“œ ì ìˆ˜: ${roundScore}, ì´ì : ${player.score}`);
            }

            // ê²Œì„ ì¢…ë£Œ í™•ì¸
            const hasWinner = game.players.some(p => p.hasCompletedRow());
            if (hasWinner) {
                console.log('ê²Œì„ ì¢…ë£Œ ì¡°ê±´ ë‹¬ì„±!');
                endGame();
                return;
            }

            // ë‹¤ìŒ ë¼ìš´ë“œ
            game.round++;
            console.log('ë‹¤ìŒ ë¼ìš´ë“œë¡œ:', game.round);
            startNewRound();
            renderGame();

            // í˜„ì¬ í”Œë ˆì´ì–´ê°€ AIë©´ AI í„´ ì‹œì‘
            if (!game.gameOver && game.players[game.currentPlayer].isAI) {
                console.log('ë¼ìš´ë“œ ì‹œì‘ - AI í„´ ì‹œì‘');
                setTimeout(aiTurn, 1000);
            }
        }

        // ===== ê²Œì„ ì¢…ë£Œ =====
        function endGame() {
            game.gameOver = true;

            // ìµœì¢… ë³´ë„ˆìŠ¤ ì ìˆ˜
            for (let player of game.players) {
                player.finalScoring();
            }

            // ìŠ¹ì ê²°ì •
            const player1 = game.players[0];
            const player2 = game.players[1];
            const isDraw = player1.score === player2.score;
            const winner = player1.score > player2.score ? player1 : player2;

            // ì˜¤ë²„ë ˆì´ ìƒì„±
            const overlay = document.createElement('div');
            overlay.className = 'game-over-overlay';
            overlay.onclick = () => {
                // ì˜¤ë²„ë ˆì´ í´ë¦­ ì‹œ ë‹«ê¸°
                overlay.remove();
                gameOverDiv.remove();
            };

            // ê²Œì„ ì˜¤ë²„ íŒì—… ìƒì„±
            const gameOverDiv = document.createElement('div');
            gameOverDiv.className = 'game-over';

            let winnerHTML = '';
            if (isDraw) {
                winnerHTML = `
                    <div class="winner-announcement draw">
                        <h3>ğŸ¤ ë¬´ìŠ¹ë¶€!</h3>
                        <p>ë‘ í”Œë ˆì´ì–´ ëª¨ë‘ í›Œë¥­í–ˆìŠµë‹ˆë‹¤!</p>
                    </div>
                `;
            } else {
                const winnerIcon = winner === player1 ? 'ğŸ”µ' : 'ğŸŸ ';
                const winnerColor = winner === player1 ? '#5dade2' : '#f39c12';
                winnerHTML = `
                    <div class="winner-announcement">
                        <h3 style="color: ${winnerColor};">${winnerIcon} ${winner.name} ìŠ¹ë¦¬! ğŸ†</h3>
                        <p>${winner.score - (winner === player1 ? player2.score : player1.score)}ì  ì°¨ì´ë¡œ ì´ê²¼ìŠµë‹ˆë‹¤!</p>
                    </div>
                `;
            }

            gameOverDiv.innerHTML = `
                <h2>ğŸ‰ ê²Œì„ ì¢…ë£Œ!</h2>
                ${winnerHTML}
                <div class="final-scores">
                    <h3 style="color: #3498db; margin-bottom: 15px;">ìµœì¢… ì ìˆ˜</h3>
                    <p style="color: #5dade2; font-weight: ${player1 === winner && !isDraw ? 'bold' : 'normal'}; 
                              font-size: ${player1 === winner && !isDraw ? '1.3em' : '1em'};">
                        ğŸ”µ ${player1.name}: <span style="color: #2ecc71;">${player1.score}ì </span>
                        ${player1 === winner && !isDraw ? ' âœ¨' : ''}
                    </p>
                    <p style="color: #f39c12; font-weight: ${player2 === winner && !isDraw ? 'bold' : 'normal'}; 
                              font-size: ${player2 === winner && !isDraw ? '1.3em' : '1em'};">
                        ğŸŸ  ${player2.name}: <span style="color: #2ecc71;">${player2.score}ì </span>
                        ${player2 === winner && !isDraw ? ' âœ¨' : ''}
                    </p>
                </div>
                <button onclick="restartGame(); document.querySelector('.game-over-overlay').remove(); document.querySelector('.game-over').remove();">
                    ğŸ”„ ìƒˆ ê²Œì„ ì‹œì‘
                </button>
            `;

            document.body.appendChild(overlay);
            document.body.appendChild(gameOverDiv);

            // íš¨ê³¼ìŒ ëŒ€ì‹  ì½˜ì†”ì— ë¡œê·¸
            console.log('ğŸ‰ ê²Œì„ ì¢…ë£Œ!', isDraw ? 'ë¬´ìŠ¹ë¶€!' : `${winner.name} ìŠ¹ë¦¬!`);
        }

        // ===== ë‹¤ìŒ í„´ =====
        function nextTurn() {
            const prevPlayer = game.players[game.currentPlayer].name;
            game.currentPlayer = (game.currentPlayer + 1) % game.players.length;
            const nextPlayer = game.players[game.currentPlayer].name;
            console.log(`í„´ ì „í™˜: ${prevPlayer} â†’ ${nextPlayer}`);
        }

        // ===== AI í„´ =====
        function aiTurn() {
            if (game.gameOver) return;

            const player = game.players[game.currentPlayer];
            if (!player.isAI) return;

            console.log('========================================');
            console.log('AI í„´ ì‹œì‘:', player.name);
            console.log('ê³µì¥ ìƒíƒœ:', game.factories.map(f => f.length));
            console.log('ì¤‘ì•™ ìƒíƒœ:', game.center.length, game.center);

            // ê³µì¥ê³¼ ì¤‘ì•™ì´ ëª¨ë‘ ë¹„ì–´ìˆìœ¼ë©´ ë¼ìš´ë“œ ì¢…ë£Œ
            if (game.factories.every(f => f.length === 0) && game.center.length === 0) {
                console.log('AI: ëª¨ë“  ê³µì¥ê³¼ ì¤‘ì•™ì´ ë¹„ì–´ìˆìŒ - ë¼ìš´ë“œ ì¢…ë£Œ');
                endRound();
                return;
            }

            // ê°„ë‹¨í•œ AI ë¡œì§: ê°€ì¥ ë§ì€ íƒ€ì¼ì„ ì„ íƒí•˜ê³ , ë°°ì¹˜ ê°€ëŠ¥í•œ ì²« ë²ˆì§¸ ì¤„ì— ë°°ì¹˜
            let bestMove = null;
            let maxTiles = 0;

            // ê³µì¥ì—ì„œ ì„ íƒ
            for (let i = 0; i < game.factories.length; i++) {
                const factory = game.factories[i];
                if (factory.length === 0) continue;
                
                for (let color of COLORS) {
                    const count = factory.filter(t => t === color).length;
                    if (count > 0) {
                        // ë°°ì¹˜ ê°€ëŠ¥í•œ ì¤„ ì°¾ê¸° (ì•„ë˜ë¶€í„°)
                        for (let lineIndex = 4; lineIndex >= 0; lineIndex--) {
                            if (player.canPlaceInPatternLine(lineIndex, color)) {
                                if (count > maxTiles) {
                                    maxTiles = count;
                                    bestMove = {
                                        source: 'factory',
                                        factoryIndex: i,
                                        color: color,
                                        lineIndex: lineIndex,
                                        tiles: count
                                    };
                                }
                                break;
                            }
                        }
                    }
                }
            }

            // ì¤‘ì•™ì—ì„œ ì„ íƒ
            for (let color of COLORS) {
                const count = game.center.filter(t => t === color).length;
                if (count > 0) {
                    for (let lineIndex = 4; lineIndex >= 0; lineIndex--) {
                        if (player.canPlaceInPatternLine(lineIndex, color)) {
                            if (count > maxTiles) {
                                maxTiles = count;
                                bestMove = {
                                    source: 'center',
                                    color: color,
                                    lineIndex: lineIndex,
                                    tiles: count
                                };
                            }
                            break;
                        }
                    }
                }
            }

            // ì›€ì§ì„ ì‹¤í–‰
            if (bestMove) {
                console.log('AI ìµœì„ ì˜ ìˆ˜:', bestMove);
                
                setTimeout(() => {
                    if (bestMove.source === 'factory') {
                        selectTilesFromFactory(bestMove.factoryIndex, bestMove.color);
                    } else {
                        selectTilesFromCenter(bestMove.color);
                    }
                    
                    // íŒ¨í„´ ë¼ì¸ì— ë°°ì¹˜
                    setTimeout(() => {
                        placeInPatternLine(bestMove.lineIndex);
                    }, 500);
                }, 500);
            } else {
                // ë°°ì¹˜ ê°€ëŠ¥í•œ ê³³ì´ ì—†ìœ¼ë©´ ì„ì˜ë¡œ ì„ íƒí•˜ê³  ë°”ë‹¥ìœ¼ë¡œ
                console.log('AI: ë°°ì¹˜ ê°€ëŠ¥í•œ ê³³ ì—†ìŒ, ë°”ë‹¥ìœ¼ë¡œ ë³´ë‚´ê¸°');
                
                setTimeout(() => {
                    // ì²« ë²ˆì§¸ ì‚¬ìš© ê°€ëŠ¥í•œ íƒ€ì¼ ì„ íƒ
                    let selectedColor = null;
                    let selectedSource = null;
                    let selectedIndex = -1;

                    // ê³µì¥ì—ì„œ ì°¾ê¸°
                    for (let i = 0; i < game.factories.length; i++) {
                        if (game.factories[i].length > 0) {
                            selectedColor = game.factories[i][0];
                            selectedSource = 'factory';
                            selectedIndex = i;
                            console.log(`AI: ê³µì¥ ${i}ì—ì„œ ${selectedColor} ì„ íƒ (ë°”ë‹¥ìœ¼ë¡œ)`);
                            break;
                        }
                    }

                    // ê³µì¥ì— ì—†ìœ¼ë©´ ì¤‘ì•™ì—ì„œ
                    if (!selectedColor) {
                        for (let color of COLORS) {
                            if (game.center.filter(t => t === color).length > 0) {
                                selectedColor = color;
                                selectedSource = 'center';
                                console.log(`AI: ì¤‘ì•™ì—ì„œ ${selectedColor} ì„ íƒ (ë°”ë‹¥ìœ¼ë¡œ)`);
                                break;
                            }
                        }
                    }

                    if (selectedColor) {
                        if (selectedSource === 'factory') {
                            selectTilesFromFactory(selectedIndex, selectedColor);
                        } else {
                            selectTilesFromCenter(selectedColor);
                        }

                        // ë°”ë‹¥ìœ¼ë¡œ ë³´ë‚´ê¸°
                        setTimeout(() => {
                            if (game.selectedTiles) {
                                console.log('AI: íƒ€ì¼ì„ ë°”ë‹¥ìœ¼ë¡œ ë³´ëƒ„:', game.selectedTiles.length + 'ê°œ');
                                player.floor.push(...game.selectedTiles);
                                game.selectedTiles = null;
                                game.selectedSource = null;

                                // í„´ ì¢…ë£Œ ì²´í¬
                                if (isRoundOver()) {
                                    console.log('AI: ë¼ìš´ë“œ ì¢…ë£Œ');
                                    endRound();
                                } else {
                                    console.log('AI: ë‹¤ìŒ í„´ìœ¼ë¡œ');
                                    nextTurn();
                                }

                                renderGame();
                            } else {
                                console.error('AI: selectedTilesê°€ nullì…ë‹ˆë‹¤!');
                                // ê°•ì œë¡œ ë‹¤ìŒ í„´
                                nextTurn();
                                renderGame();
                            }
                        }, 500);
                    } else {
                        // ì„ íƒí•  íƒ€ì¼ì´ ì „í˜€ ì—†ìŒ - ë¼ìš´ë“œ ì¢…ë£Œ
                        console.log('AI: ì„ íƒí•  íƒ€ì¼ì´ ì—†ìŒ - ë¼ìš´ë“œ ì¢…ë£Œ');
                        if (isRoundOver()) {
                            endRound();
                        } else {
                            nextTurn();
                        }
                        renderGame();
                    }
                }, 500);
            }
        }

        // ===== ê²Œì„ ë Œë”ë§ =====
        function renderGame() {
            // í—¤ë” ì—…ë°ì´íŠ¸
            document.getElementById('round-number').textContent = game.round;
            const currentTurnDisplay = document.getElementById('current-turn-display');
            const currentPlayerName = game.players[game.currentPlayer].name;
            const playerIcon = game.currentPlayer === 0 ? 'ğŸ”µ' : 'ğŸŸ ';
            const playerColor = game.currentPlayer === 0 ? '#5dade2' : '#f39c12';
            
            currentTurnDisplay.innerHTML = `í˜„ì¬ í„´: <span style="color: ${playerColor}; font-weight: bold;">${playerIcon} ${currentPlayerName}</span>`;

            // ê³µì¥ ë Œë”ë§
            renderFactories();

            // ì¤‘ì•™ ë Œë”ë§
            renderCenter();

            // í”Œë ˆì´ì–´ A ë³´ë“œ ë Œë”ë§
            renderPlayerBoard(game.players[0], 'player-a-board', game.currentPlayer === 0);
            document.getElementById('player-a-score').textContent = `${game.players[0].score}ì `;
            
            // í”Œë ˆì´ì–´ B ë³´ë“œ ë Œë”ë§
            renderPlayerBoard(game.players[1], 'player-b-board', game.currentPlayer === 1);
            document.getElementById('player-b-score').textContent = `${game.players[1].score}ì `;

            // ë³´ë“œ ì»¨í…Œì´ë„ˆì— active/inactive í´ë˜ìŠ¤ ì¶”ê°€
            const containerA = document.getElementById('player-a-container');
            const containerB = document.getElementById('player-b-container');

            if (game.currentPlayer === 0) {
                containerA.classList.add('active');
                containerA.classList.remove('inactive');
                containerB.classList.add('inactive');
                containerB.classList.remove('active');
            } else {
                containerB.classList.add('active');
                containerB.classList.remove('inactive');
                containerA.classList.add('inactive');
                containerA.classList.remove('active');
            }
        }

        function renderFactories() {
            const container = document.getElementById('factories');
            container.innerHTML = '';

            const isAITurn = game.players[game.currentPlayer].isAI;

            game.factories.forEach((factory, index) => {
                const factoryDiv = document.createElement('div');
                factoryDiv.className = 'factory';
                
                // ì„ íƒ ê°€ëŠ¥í•œ ìƒ‰ìƒ í™•ì¸ (AI í„´ì´ ì•„ë‹ˆê³ , íƒ€ì¼ì´ ì„ íƒë˜ì§€ ì•Šì•˜ì„ ë•Œ)
                if (!isAITurn && !game.selectedTiles && factory.length > 0) {
                    factoryDiv.classList.add('selectable');
                }

                factory.forEach(color => {
                    const tile = createTile(color);
                    if (!isAITurn) {
                        tile.onclick = () => {
                            if (!game.selectedTiles) {
                                selectTilesFromFactory(index, color);
                            }
                        };
                    }
                    factoryDiv.appendChild(tile);
                });

                container.appendChild(factoryDiv);
            });
        }

        function renderCenter() {
            const container = document.getElementById('center');
            container.innerHTML = '';

            const isAITurn = game.players[game.currentPlayer].isAI;

            if (!isAITurn && !game.selectedTiles && game.center.length > 0) {
                container.classList.add('selectable');
            } else {
                container.classList.remove('selectable');
            }

            // ë¹„ì–´ìˆì„ ë•Œ ì•ˆë‚´ ë¬¸êµ¬
            if (game.center.length === 0) {
                const placeholder = document.createElement('h4');
                placeholder.style.width = '100%';
                placeholder.style.textAlign = 'center';
                placeholder.style.color = '#7f8c8d';
                placeholder.textContent = 'ì¤‘ì•™ ì˜ì—­ (ë¹„ì–´ìˆìŒ)';
                container.appendChild(placeholder);
            } else {
                game.center.forEach(tile => {
                    const tileDiv = createTile(tile);
                    if (tile !== 'start' && !isAITurn) {
                        tileDiv.onclick = () => {
                            if (!game.selectedTiles) {
                                selectTilesFromCenter(tile);
                            }
                        };
                    }
                    container.appendChild(tileDiv);
                });
            }
        }

        function renderPlayerBoard(player, containerId, isCurrentPlayer) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';

            const boardDiv = document.createElement('div');
            boardDiv.className = 'player-board';

            // íŒ¨í„´ ë¼ì¸
            const patternDiv = document.createElement('div');
            patternDiv.innerHTML = '<div class="section-title">íŒ¨í„´ ë¼ì¸</div>';
            const patternLinesDiv = document.createElement('div');
            patternLinesDiv.className = 'pattern-lines';

            for (let i = 0; i < 5; i++) {
                const lineDiv = document.createElement('div');
                lineDiv.className = 'pattern-line';

                // í˜„ì¬ í„´ì´ê³ , íƒ€ì¼ì„ ì„ íƒí–ˆê³ , ë°°ì¹˜ ê°€ëŠ¥í•œ ê²½ìš°ì—ë§Œ í´ë¦­ ê°€ëŠ¥
                if (isCurrentPlayer && !player.isAI && game.selectedTiles && 
                    player.canPlaceInPatternLine(i, game.selectedTiles[0])) {
                    lineDiv.classList.add('selectable');
                    lineDiv.onclick = () => placeInPatternLine(i);
                }

                for (let j = 0; j <= i; j++) {
                    const slot = document.createElement('div');
                    slot.className = 'pattern-slot';
                    
                    if (player.patternLines[i][j]) {
                        const tile = createTile(player.patternLines[i][j]);
                        slot.appendChild(tile);
                        slot.classList.add('filled');
                    }
                    
                    lineDiv.appendChild(slot);
                }

                patternLinesDiv.appendChild(lineDiv);
            }
            patternDiv.appendChild(patternLinesDiv);

            // ë²½
            const wallDiv = document.createElement('div');
            wallDiv.innerHTML = '<div class="section-title">ë²½</div>';
            const wallGrid = document.createElement('div');
            wallGrid.className = 'wall';

            for (let row = 0; row < 5; row++) {
                for (let col = 0; col < 5; col++) {
                    const slot = document.createElement('div');
                    slot.className = `wall-slot ${WALL_PATTERN[row][col]}`;
                    
                    if (player.wall[row][col]) {
                        slot.classList.add('filled');
                        const tile = createTile(WALL_PATTERN[row][col]);
                        tile.style.width = '100%';
                        tile.style.height = '100%';
                        slot.appendChild(tile);
                    }
                    
                    wallGrid.appendChild(slot);
                }
            }
            wallDiv.appendChild(wallGrid);

            boardDiv.appendChild(patternDiv);
            boardDiv.appendChild(wallDiv);

            // ë°”ë‹¥ ë¼ì¸
            const floorDiv = document.createElement('div');
            floorDiv.className = 'floor-line';
            floorDiv.innerHTML = '<h4>ë°”ë‹¥ ë¼ì¸ (ë²Œì )</h4>';
            const floorSlots = document.createElement('div');
            floorSlots.className = 'floor-slots';

            for (let i = 0; i < 7; i++) {
                const slot = document.createElement('div');
                slot.className = 'floor-slot';
                
                if (player.floor[i]) {
                    const tile = createTile(player.floor[i]);
                    slot.appendChild(tile);
                }

                const penalty = document.createElement('div');
                penalty.className = 'floor-penalty';
                penalty.textContent = FLOOR_PENALTIES[i];
                slot.appendChild(penalty);
                
                floorSlots.appendChild(slot);
            }
            floorDiv.appendChild(floorSlots);

            container.appendChild(boardDiv);
            container.appendChild(floorDiv);
        }

        function createTile(color) {
            const tile = document.createElement('div');
            tile.className = `tile ${color}`;
            if (color === 'start') {
                tile.classList.add('start-marker');
                tile.textContent = '1';
                tile.title = 'ì‹œì‘ ë§ˆì»¤ (-1ì )';
            }
            return tile;
        }

        // ===== ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ =====
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // ===== UI í•¨ìˆ˜ =====
        function showRules() {
            document.getElementById('rules-modal').style.display = 'block';
        }

        function closeRules() {
            document.getElementById('rules-modal').style.display = 'none';
        }

        function restartGame() {
            // ê²Œì„ ì˜¤ë²„ ë©”ì‹œì§€ì™€ ì˜¤ë²„ë ˆì´ ì œê±°
            const gameOverDiv = document.querySelector('.game-over');
            const overlay = document.querySelector('.game-over-overlay');
            if (gameOverDiv) gameOverDiv.remove();
            if (overlay) overlay.remove();
            
            initGame();
        }

        function toggleAI() {
            game.aiEnabled = !game.aiEnabled;
            const btn = document.getElementById('ai-toggle');
            btn.textContent = game.aiEnabled ? 'ğŸ¤– í”Œë ˆì´ì–´ B: AI' : 'ğŸ‘¤ í”Œë ˆì´ì–´ B: ì‚¬ëŒ';
            restartGame();
        }

        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ì‹œ ë‹«ê¸°
        window.onclick = function(event) {
            const modal = document.getElementById('rules-modal');
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        }

        // ===== ê²Œì„ ì‹œì‘ =====
        window.onload = function() {
            initGame();
        };
    </script>
</body>
</html>
